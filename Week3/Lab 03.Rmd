---
title: "Lab 03"
output: html_document
date: "2024-08-15"
---

## Dishonest dice

Binomial dist 

$$P(X=x)=\binom{n}{x} p^x (1-p)^{1-x}$$

```{r}
y = c(1, 15, 42, 32, 10) # input the observed counts
x = 0:4 # define the corresponding group, number of possibilities
```

We calculate p assuming our data follows a bin dist. 
```{r}
n=sum(y)
k=length(y)

# size: numbers of dies
p=dbinom(x, size=4, p=0.5)
p

sum(p) # to make sure they sum up to 1.
```

Assumption:

```{r}
ey = 100 * p
ey >= 5 # ckeck for assumption
```

Test statistics
large $t_0$ : big differece between $y_i$ and $e_i$ $\to$ properly reject $H_0$.
```{r}
t0 = sum( (y-ey)^2 / ey)
```


P-value
```{r}
pval = 1 - pchisq(t0, df=k-1)
pchisq(t0, df=k-1, lower.tail = FALSE)

```

```{r}
chis
```



## Mammograms

```{r}
x = matrix(c(10, 20, 90, 99980), ncol = 2)
colnames(x) = c("Breast cancer: yes", "Breast cancer: no") # D
rownames(x) = c("Mammogram: positive", "Mammogram: negative") # R
x
```

Using the code below, we have to take 1/result, since mosaic thinks the row order is reverse such that $R^-$ is first. 
Either you reverse the roworder or take the 1/x. 
```{r}
1/mosaic::relrisk(x)
```


1. Is it appropriate to use a relative risk to quantify the relationship between the risk factor (Mammogram result) and disease (Breast cancer)? 
If so calculate the relative risk and provide an interpretation.

RR can be calculated for prospective studies (PS)

We classify the women based on them having the risk factor => PS

$$RR = \frac{a(c+d)}{c(a+b)}$$

```{r}
(10*(20+99980))/(20*(10+90))
```

RR > 1 : breast cancer is more likely to occur in the positive mammogram group.

Given the risk factor is NOT present, the probability of having the disease is very small. The nominator is very large:
$P(D^+ | R^+)$ is 500 times as large as $P(D^+ | R^-)$


2. Calculate the odds ratio of having breast cancer for positive vs negative mammograms and provide an interpretation.

```{r}
(10*99980)/(90*20)
```

Same as for the RR, take the 1/result since we havenot reversed the row order for the risk factor. 
```{r}
1/mosaic::oddsRatio(x)
```


3. Calculate a confidence interval for the odds-ratio, is there evidence that there might be a relationship between mammogram test results and breast cancer diagnosis?


```{r}
se = sqrt(1/10 + 1/20 + 1/90 + 1/99980) # marginal error (standard deviation)
or = (10*99980)/(20*90)

# generate the 95% confidence interval 
log_ci = c(log(or) - qnorm(0.975) * se, log(or) + qnorm(0.975) * se)
ci = exp(log_ci)
ci
```

There is a relation between the mammogram and breast cancer diagnosis

If OR is inside of the interval: no relation between R and D


Using the mosaic package to get all data in the OR calculations.
```{r}
y= x[c(2,1), ] # change row order
mosaic::oddsRatio(y, verbose = TRUE)
```


## Soccer goals

```{r}
goals <- c(
  1, 0, 0, 1, 1, 0, 0, 0, 1, 1, 2, 2, 4, 0, 10,
  0, 1, 1, 2, 3, 0, 4, 1, 3, 6, 0, 1, 0, 10, 1,
  2, 1, 0, 1, 1, 2, 3, 3, 3, 1, 2, 0, 0, 0, 0,
  1, 1, 1, 1, 1, 2, 0, 1, 0, 2, 2, 0, 1, 2, 1,
  1, 0, 1, 1, 0, 2, 2, 1, 0, 5, 2, 1, 4, 1, 1,
  0, 0, 1, 3, 0, 1, 0, 1, 2, 2, 0, 2, 1, 1, 1,
  0, 1, 0, 1, 2, 1, 2, 0, 2, 1, 0, 1, 5, 2
)
observed_goals = table(goals)
```

Test the null hypothesis that the number of goals scored per game follows a Poisson distribution.

```{r}
n=104

# Expected frequencies based on Poisson distribution
lambda <- mean(goals) # statistical inference
lambda 

exp_freq <- dpois(as.numeric(names(observed_goals)), lambda) * length(goals)
# OR

# P(X=0), P(X=1), ..., P(X=9) and P(X>9) = 1-P(X=0)-P(X=1) - ... - P(X=9) 
hyp_probs = c(dpois(0:9, lambda), ppois(9, lambda, lower.tail = FALSE))

exp_goals = n * hyp_probs
round(exp_goals)
# since the last 7 cells are < 5 => we have to combine them
```


Beaware of chisq test and df! it assume that there are no parameters to estimate

Used pchi test

You will need to estimate the $\lambda$ parameter and collapse categories (if necessary) to make sure the assumptions are met.

```{r}
hist(goals, 
     breaks = 10, col = 'lightblue', main = 'Histogram of Data', 
     xlab = 'Number of goals scored pere game', ylab = 'Frequency')
```


## Education

```{r}
## Reading in the data
library("tidyverse")
edu = readr::read_delim("https://raw.githubusercontent.com/DATA2002/data/master/education-by-age-census.txt",delim = "\t")
edu = edu |> janitor::clean_names()
knitr::kable(edu)
```


```{r}
edu |> tidyr::pivot_wider(id_cols = education, names_from = age_group, values_from =  count) |> 
  gt::gt() |> 
  gt::tab_spanner(label = "Age group", columns = 2:6) |> 
  gt::cols_label(education = "Education level")
```

